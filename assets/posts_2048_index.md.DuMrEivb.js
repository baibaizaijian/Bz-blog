import{_ as Y,a9 as y,p as v,v as R,x as U,c as f,o as d,j as g,e as B,t as T,F as N,B as S,n as F,G as P}from"./chunks/framework.DMsllxUh.js";const z={id:"game"},J={class:"header"},K={class:"score"},W={key:0,class:"toast"},q=["data-num"],H={key:0,class:"cell-content"},Q=Object.assign({name:"Game2048Board"},{__name:"2048",setup(C){const s=y(Array(5).fill(0).map(()=>Array(5).fill(0))),p=y({value:0}),l=y({}),E=v(0),D=v(0),$=v(0),A=v(0),k=v(!1),M=v("");function w(e){M.value=e,k.value=!0,window.setTimeout(()=>{k.value=!1},1200)}function m(){const e=[];if(s.forEach((r,o)=>r.forEach((n,c)=>{n===0&&e.push([o,c])})),!e.length)return;const[a,t]=e[Math.floor(Math.random()*e.length)];s[a][t]=Math.random()<.8?2:4}function x(){return s.flat().includes(2048)}function O(){if(s.flat().includes(0))return!1;for(let e=0;e<5;e+=1)for(let a=0;a<5;a+=1){const t=s[e][a];if(a<4&&s[e][a+1]===t||e<4&&s[e+1][a]===t)return!1}return!0}function G(){for(let e=0;e<5;e+=1)for(let a=0;a<5;a+=1)s[e][a]=0;p.value=0,m(),m(),Object.keys(l).forEach(e=>delete l[e])}function _(e){if(!Array.isArray(e))return{row:[0,0,0,0,0],merged:!1};let a=e.filter(r=>r!==0),t=!1;for(let r=0;r<a.length-1;r+=1)a[r]===a[r+1]&&(a[r]*=2,p.value+=a[r],a[r+1]=0,t=!0);for(a=a.filter(r=>r!==0);a.length<5;)a.push(0);return{row:a,merged:t}}function u(e){return e[0].map((a,t)=>e.map(r=>r[t]))}function i(e){let a=!1,t=s.map(r=>[...r]);switch(Object.keys(l).forEach(r=>delete l[r]),e){case"up":t=u(t),t=t.map((r,o)=>{const n=_(r);return n.merged&&n.row.forEach((c,h)=>{c>0&&(l[`${h}-${o}`]=!0)}),n.row}),t=u(t),t=u(t),t=u(t);break;case"down":t=u(t),t=t.map((r,o)=>{const n=[...r].reverse(),c=_(n);return c.merged&&c.row.forEach((h,b)=>{h>0&&(l[`${4-b}-${o}`]=!0)}),c.row.reverse()}),t=u(t),t=u(t),t=u(t);break;case"left":t=t.map((r,o)=>{const n=_(r);return n.merged&&n.row.forEach((c,h)=>{c>0&&(l[`${o}-${h}`]=!0)}),n.row});break;case"right":t=t.map((r,o)=>{const n=[...r].reverse(),c=_(n);return c.merged&&c.row.forEach((h,b)=>{h>0&&(l[`${o}-${4-b}`]=!0)}),c.row.reverse()});break}for(let r=0;r<5;r+=1)for(let o=0;o<5;o+=1)t[r][o]!==s[r][o]&&(a=!0),s[r][o]=t[r][o];return a}function j(e){let a=!1;switch(e.key){case"ArrowUp":e.preventDefault(),a=i("up");break;case"ArrowDown":e.preventDefault(),a=i("down");break;case"ArrowLeft":e.preventDefault(),a=i("left");break;case"ArrowRight":e.preventDefault(),a=i("right");break;default:return}a&&(m(),x()&&window.setTimeout(()=>w("你赢了 2048!"),300),O()&&window.setTimeout(()=>w("游戏结束!"),300))}function L(e){e.preventDefault(),E.value=e.touches[0].clientX,D.value=e.touches[0].clientY}function V(e){e.preventDefault()}function X(e){e.preventDefault(),$.value=e.changedTouches[0].clientX,A.value=e.changedTouches[0].clientY;const a=$.value-E.value,t=A.value-D.value,r=30;let o=!1;Math.abs(a)>Math.abs(t)?a>r?o=i("right"):a<-r&&(o=i("left")):t>r?o=i("down"):t<-r&&(o=i("up")),o&&(m(),x()&&window.setTimeout(()=>w("你赢了 2048!"),300),O()&&window.setTimeout(()=>w("游戏结束!"),300))}return R(()=>{m(),m(),window.addEventListener("keydown",j)}),U(()=>{window.removeEventListener("keydown",j)}),(e,a)=>(d(),f("div",z,[g("div",J,[g("div",K,"分数: "+T(p.value),1),g("button",{class:"reset-btn",onClick:G},"重新开始")]),k.value?(d(),f("div",W,T(M.value),1)):B("",!0),g("div",{class:"board",onTouchstart:L,onTouchmove:V,onTouchend:X},[(d(!0),f(N,null,S(s,(t,r)=>(d(),f("div",{key:r,class:"row"},[(d(!0),f(N,null,S(t,(o,n)=>(d(),f("div",{key:n,class:F(["cell",{"cell-merged":l[`${r}-${n}`]}]),"data-num":o},[o?(d(),f("div",H,T(o),1)):B("",!0)],10,q))),128))]))),128))],32)]))}}),Z=Y(Q,[["__scopeId","data-v-1f8a0041"]]),te=JSON.parse('{"title":"","description":"","frontmatter":{},"headers":[],"relativePath":"posts/2048/index.md","filePath":"posts/2048/index.md","lastUpdated":1756989044000}'),I={name:"posts/2048/index.md"},re=Object.assign(I,{setup(C){return(s,p)=>(d(),f("div",null,[P(Z)]))}});export{te as __pageData,re as default};
