import{_ as C,a9 as w,p as _,v as L,x as X,c as d,o as h,j as g,t as A,F as M,B as x,n as Y,e as G,G as U}from"./chunks/framework.BTTXIzTm.js";const V={id:"game"},F={class:"header"},P={class:"score"},z=["data-num"],J={key:0,class:"cell-content"},K={__name:"2048",setup(N){const s=w(Array(5).fill(0).map(()=>Array(5).fill(0))),v=w({value:0}),c=w({}),k=_(0),b=_(0),y=_(0),E=_(0);function O(){for(let t=0;t<5;t++)for(let a=0;a<5;a++)s[t][a]=0;v.value=0,m(),m(),Object.keys(c).forEach(t=>delete c[t])}function m(){const t=[];if(s.forEach((e,n)=>e.forEach((o,l)=>{o===0&&t.push([n,l])})),!t.length)return;const[a,r]=t[Math.floor(Math.random()*t.length)];s[a][r]=Math.random()<.8?2:4}function p(t){if(!Array.isArray(t))return console.error("slideAndMerge: row is not an array",t),{row:[0,0,0,0],merged:!1};let a=t.filter(e=>e!==0),r=!1;for(let e=0;e<a.length-1;e++)a[e]===a[e+1]&&(a[e]*=2,v.value+=a[e],a[e+1]=0,r=!0);for(a=a.filter(e=>e!==0);a.length<5;)a.push(0);return{row:a,merged:r}}function i(t){return t[0].map((a,r)=>t.map(e=>e[r]))}function u(t){let a=!1,r=s.map(e=>[...e]);switch(Object.keys(c).forEach(e=>delete c[e]),t){case"up":r=i(r),r=r.map((e,n)=>{const o=p(e);return o.merged&&o.row.forEach((l,f)=>{l>0&&(c[`${f}-${n}`]=!0)}),o.row}),r=i(r),r=i(r),r=i(r);break;case"down":r=i(r),r=r.map((e,n)=>{e=[...e].reverse();const o=p(e);return o.merged&&o.row.forEach((l,f)=>{l>0&&(c[`${3-f}-${n}`]=!0)}),o.row.reverse()}),r=i(r),r=i(r),r=i(r);break;case"left":r=r.map((e,n)=>{const o=p(e);return o.merged&&o.row.forEach((l,f)=>{l>0&&(c[`${n}-${f}`]=!0)}),o.row});break;case"right":r=r.map((e,n)=>{e=[...e].reverse();const o=p(e);return o.merged&&o.row.forEach((l,f)=>{l>0&&(c[`${n}-${3-f}`]=!0)}),o.row.reverse()});break}for(let e=0;e<5;e++)for(let n=0;n<5;n++)r[e][n]!==s[e][n]&&(a=!0),s[e][n]=r[e][n];return a}function T(t){let a=!1;switch(t.key){case"ArrowUp":t.preventDefault(),a=u("up");break;case"ArrowDown":t.preventDefault(),a=u("down");break;case"ArrowLeft":t.preventDefault(),a=u("left");break;case"ArrowRight":t.preventDefault(),a=u("right");break}a&&(m(),D()&&setTimeout(()=>alert("你赢了 2048!"),300),$()&&setTimeout(()=>alert("游戏结束!"),300))}function S(t){t.preventDefault(),k.value=t.touches[0].clientX,b.value=t.touches[0].clientY}function j(t){t.preventDefault()}function B(t){t.preventDefault(),y.value=t.changedTouches[0].clientX,E.value=t.changedTouches[0].clientY;const a=y.value-k.value,r=E.value-b.value,e=30;let n=!1;Math.abs(a)>Math.abs(r)?a>e?n=u("right"):a<-e&&(n=u("left")):r>e?n=u("down"):r<-e&&(n=u("up")),n&&(m(),D()&&setTimeout(()=>alert("你赢了 2048!"),300),$()&&setTimeout(()=>alert("游戏结束!"),300))}function D(){return s.flat().includes(2048)}function $(){if(s.flat().includes(0))return!1;for(let t=0;t<4;t++)for(let a=0;a<4;a++){const r=s[t][a];if(a<3&&s[t][a+1]===r||t<3&&s[t+1][a]===r)return!1}return!0}return L(()=>{m(),m(),window.addEventListener("keydown",T)}),X(()=>{window.removeEventListener("keydown",T)}),(t,a)=>(h(),d("div",V,[g("div",F,[g("div",P,"分数: "+A(v.value),1),g("button",{class:"reset-btn",onClick:O},"重新开始")]),g("div",{class:"board",onTouchstart:S,onTouchmove:j,onTouchend:B},[(h(!0),d(M,null,x(s,(r,e)=>(h(),d("div",{key:e,class:"row"},[(h(!0),d(M,null,x(r,(n,o)=>(h(),d("div",{key:o,class:Y(["cell",{"cell-merged":c[`${e}-${o}`]}]),"data-num":n},[n?(h(),d("div",J,A(n),1)):G("",!0)],10,z))),128))]))),128))],32)]))}},R=C(K,[["__scopeId","data-v-1cf8e2be"]]),H=JSON.parse('{"title":"","description":"","frontmatter":{},"headers":[],"relativePath":"posts/2048/index.md","filePath":"posts/2048/index.md","lastUpdated":1756989044000}'),W={name:"posts/2048/index.md"},Q=Object.assign(W,{setup(N){return(s,v)=>(h(),d("div",null,[U(R)]))}});export{H as __pageData,Q as default};
