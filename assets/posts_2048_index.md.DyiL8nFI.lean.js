import{_ as J,p as v,a9 as G,h as K,v as W,x as q,c as m,o as p,j as h,e as L,t as D,n as A,F as V,B as X,N as H,G as Q}from"./chunks/framework.CxkGpqWa.js";const Z={id:"game"},I={class:"header"},ee={class:"score"},te={class:"controls"},ae={class:"modes",role:"tablist","aria-label":"棋盘模式"},re=["aria-selected"],se=["aria-selected"],oe={key:0,class:"toast"},ne=["data-num"],le={key:0,class:"cell-content"},ue=Object.assign({name:"Game2048Board"},{__name:"2048",setup(Y){const n=v(5);function y(e){return Array(e).fill(0).map(()=>Array(e).fill(0))}const u=v(y(n.value)),T=G({value:0}),i=G({}),x=v(0),S=v(0),z=v(0),M=v(0),w=v(!1),B=v(""),R=K(()=>({"--grid-size":n.value,"--cell-size":n.value===4?"92px":"80px"}));function b(e){B.value=e,w.value=!0,window.setTimeout(()=>{w.value=!1},1200)}function g(){const e=[];if(u.value.forEach((t,a)=>t.forEach((o,l)=>{o===0&&e.push([a,l])})),!e.length)return;const[r,s]=e[Math.floor(Math.random()*e.length)];u.value[r][s]=Math.random()<.8?2:4}function C(){return u.value.flat().includes(2048)}function N(){const e=n.value;if(u.value.flat().includes(0))return!1;for(let r=0;r<e;r+=1)for(let s=0;s<e;s+=1){const t=u.value[r][s];if(s<e-1&&u.value[r][s+1]===t||r<e-1&&u.value[r+1][s]===t)return!1}return!0}function E(){const e=n.value;w.value=!1,u.value=y(e),T.value=0,g(),g(),Object.keys(i).forEach(r=>delete i[r])}function k(e){const r=n.value;if(!Array.isArray(e))return{row:Array(r).fill(0),merged:!1};let s=e.filter(a=>a!==0),t=!1;for(let a=0;a<s.length-1;a+=1)s[a]===s[a+1]&&(s[a]*=2,T.value+=s[a],s[a+1]=0,t=!0);for(s=s.filter(a=>a!==0);s.length<r;)s.push(0);return{row:s,merged:t}}function d(e){return e[0].map((r,s)=>e.map(t=>t[s]))}function f(e){const r=n.value;let s=!1,t=u.value.map(a=>[...a]);switch(Object.keys(i).forEach(a=>delete i[a]),e){case"up":t=d(t),t=t.map((a,o)=>{const l=k(a);return l.merged&&l.row.forEach((c,_)=>{c>0&&(i[`${_}-${o}`]=!0)}),l.row}),t=d(t),t=d(t),t=d(t);break;case"down":t=d(t),t=t.map((a,o)=>{const l=[...a].reverse(),c=k(l);return c.merged&&c.row.forEach((_,$)=>{_>0&&(i[`${r-1-$}-${o}`]=!0)}),c.row.reverse()}),t=d(t),t=d(t),t=d(t);break;case"left":t=t.map((a,o)=>{const l=k(a);return l.merged&&l.row.forEach((c,_)=>{c>0&&(i[`${o}-${_}`]=!0)}),l.row});break;case"right":t=t.map((a,o)=>{const l=[...a].reverse(),c=k(l);return c.merged&&c.row.forEach((_,$)=>{_>0&&(i[`${o}-${r-1-$}`]=!0)}),c.row.reverse()});break}for(let a=0;a<r;a+=1)for(let o=0;o<r;o+=1)t[a][o]!==u.value[a][o]&&(s=!0),u.value[a][o]=t[a][o];return s}function O(e){n.value!==e&&(n.value=e,E())}function j(e){let r=!1;switch(e.key){case"ArrowUp":e.preventDefault(),r=f("up");break;case"ArrowDown":e.preventDefault(),r=f("down");break;case"ArrowLeft":e.preventDefault(),r=f("left");break;case"ArrowRight":e.preventDefault(),r=f("right");break;default:return}r&&(g(),C()&&window.setTimeout(()=>b("你赢了 2048!"),300),N()&&window.setTimeout(()=>b("游戏结束!"),300))}function U(e){e.preventDefault(),x.value=e.touches[0].clientX,S.value=e.touches[0].clientY}function F(e){e.preventDefault()}function P(e){e.preventDefault(),z.value=e.changedTouches[0].clientX,M.value=e.changedTouches[0].clientY;const r=z.value-x.value,s=M.value-S.value,t=30;let a=!1;Math.abs(r)>Math.abs(s)?r>t?a=f("right"):r<-t&&(a=f("left")):s>t?a=f("down"):s<-t&&(a=f("up")),a&&(g(),C()&&window.setTimeout(()=>b("你赢了 2048!"),300),N()&&window.setTimeout(()=>b("游戏结束!"),300))}return W(()=>{E(),window.addEventListener("keydown",j)}),q(()=>{window.removeEventListener("keydown",j)}),(e,r)=>(p(),m("div",Z,[h("div",I,[h("div",ee,"分数: "+D(T.value),1),h("div",te,[h("div",ae,[h("button",{class:A(["mode-btn",{active:n.value===4}]),type:"button",role:"tab","aria-selected":n.value===4,onClick:r[0]||(r[0]=s=>O(4))}," 4×4 ",10,re),h("button",{class:A(["mode-btn",{active:n.value===5}]),type:"button",role:"tab","aria-selected":n.value===5,onClick:r[1]||(r[1]=s=>O(5))}," 5×5 ",10,se)]),h("button",{class:"reset-btn",type:"button",onClick:E}," 重新开始 ")])]),w.value?(p(),m("div",oe,D(B.value),1)):L("",!0),h("div",{class:"board",style:H(R.value),onTouchstart:U,onTouchmove:F,onTouchend:P},[(p(!0),m(V,null,X(u.value,(s,t)=>(p(),m("div",{key:t,class:"row"},[(p(!0),m(V,null,X(s,(a,o)=>(p(),m("div",{key:o,class:A(["cell",{"cell-merged":i[`${t}-${o}`]}]),"data-num":a},[a?(p(),m("div",le,D(a),1)):L("",!0)],10,ne))),128))]))),128))],36)]))}}),ce=J(ue,[["__scopeId","data-v-741e376a"]]),fe=JSON.parse('{"title":"","description":"","frontmatter":{},"headers":[],"relativePath":"posts/2048/index.md","filePath":"posts/2048/index.md","lastUpdated":1756989044000}'),ie={name:"posts/2048/index.md"},ve=Object.assign(ie,{setup(Y){return(n,y)=>(p(),m("div",null,[Q(ce)]))}});export{fe as __pageData,ve as default};
